import math
from math import *

def myGaus(x, mu, sigma):
    print "type x", type(x)
    return 1/( sigma * np.sqrt(2.0*pi) ) * np.exp( - (x - mu)*(x - mu) / 2.0/sigma/sigma )

def func(x, a, b, c, d, e, f, g, h, i, j):
    return a*myGaus(x, b, c) + d*myGaus(x, e, f) + g*myGaus(x, h, i) + j

def my_func(x, y):
  return func(x,
              y[0], y[1], y[2], y[3], y[4],
              y[5], y[6], y[7], y[8], y[9])

fitparams_scenario_1 = [ 0.18460216,  0.36087868,  0.08658201,  1.33776152,  3.08281802,  0.04873429,
  6.95849706,  2.03313206,  0.99300184,  2.21479736]

data_scenario_1 = [
[ 0.2113 , 0.9524 , 1.491 , 2.5938 , 4.6408 , 7.8619 ],
[ 0.2400 , 1.1953 , 1.8016 , 3.0 , 5.1764 , 8.5985 ],
[ 0.2600 , 1.3781 , 2.0484 , 3.3281 , 5.6364 , 9.1745 ],
[ 0.3000 , 1.5282 , 2.2763 , 3.6562 , 6.1047 , 9.8256 ],
[ 0.3300 , 1.5478 , 2.3055 , 3.7031 , 6.2125 , 10.0381 ],
[ 0.3600 , 1.5398 , 2.3058 , 3.7188 , 6.2387 , 10.0804 ],
[ 0.4000 , 1.4804 , 2.2122 , 3.6094 , 6.1127 , 9.8738 ],
[ 0.4300 , 1.4282 , 2.1458 , 3.5156 , 5.982 , 9.7341 ],
[ 0.4600 , 1.3901 , 2.0885 , 3.4219 , 5.8497 , 9.5868 ],
[ 0.5000 , 1.3447 , 2.0426 , 3.375 , 5.7696 , 9.4906 ],
[ 0.5300 , 1.3385 , 2.0332 , 3.3594 , 5.7429 , 9.4816 ],
[ 0.5600 , 1.3385 , 2.0332 , 3.3594 , 5.7697 , 9.486 ],
[ 0.6000 , 1.3385 , 2.0332 , 3.3594 , 5.7429 , 9.4816 ],
[ 0.7000 , 1.3705 , 2.0703 , 3.4062 , 5.823 , 9.5785 ],
[ 0.8000 , 1.46 , 2.1935 , 3.5938 , 6.0863 , 9.9068 ],
[ 0.8800 , 1.4663 , 2.203 , 3.6094 , 6.1127 , 9.9498 ],
[ 0.9000 , 1.4663 , 2.203 , 3.6094 , 6.1127 , 9.9498 ],
[ 0.9100 , 1.4868 , 2.2218 , 3.625 , 6.1392 , 9.9929 ],
[ 0.9200 , 1.4996 , 2.241 , 3.6562 , 6.1921 , 10.079 ],
[ 0.9300 , 1.5125 , 2.2601 , 3.6875 , 6.245 , 10.0876 ],
[ 0.9400 , 1.5189 , 2.2697 , 3.7031 , 6.2715 , 10.1303 ],
[ 1.0000 , 1.6743 , 2.463 , 3.9688 , 6.5948 , 10.5717 ],
[ 1.1000 , 1.6523 , 2.4432 , 3.9531 , 6.6319 , 10.6315 ],
[ 1.2000 , 1.7205 , 2.5493 , 4.0781 , 6.7766 , 10.8631 ],
[ 1.3000 , 1.8329 , 2.6691 , 4.2656 , 7.0541 , 11.2608 ],
[ 1.4000 , 1.9067 , 2.7965 , 4.4375 , 7.303 , 11.5592 ],
[ 1.5000 , 2.0234 , 2.938 , 4.625 , 7.5378 , 11.8716 ],
[ 1.6000 , 2.0781 , 3.0175 , 4.75 , 7.7415 , 12.1924 ],
[ 1.7000 , 2.1656 , 3.1291 , 4.9062 , 7.9571 , 12.4716 ],
[ 1.8000 , 2.2001 , 3.179 , 4.9844 , 8.044 , 12.6562 ],
[ 1.9000 , 2.2544 , 3.2416 , 5.0625 , 8.1701 , 12.7417 ],
[ 2.0000 , 2.2544 , 3.2416 , 5.0625 , 8.1701 , 12.7417 ],
[ 2.1000 , 2.2474 , 3.2316 , 5.0469 , 8.1449 , 12.7586 ],
[ 2.2000 , 2.2196 , 3.1916 , 4.9844 , 8.0838 , 12.6702 ],
[ 2.3000 , 2.1588 , 3.1192 , 4.8906 , 7.9317 , 12.4319 ],
[ 2.4000 , 2.0918 , 3.0373 , 4.7812 , 7.7925 , 12.2726 ],
[ 2.5000 , 2.0054 , 2.9263 , 4.625 , 7.5378 , 11.9735 ],
[ 2.6000 , 1.9202 , 2.8162 , 4.4688 , 7.3544 , 11.6406 ],
[ 2.7000 , 1.8362 , 2.7068 , 4.3125 , 7.0972 , 11.3746 ],
[ 2.8000 , 1.7798 , 2.6372 , 4.2188 , 7.0102 , 11.1467 ],
[ 2.9000 , 1.8828 , 2.7754 , 4.4219 , 7.3125 , 11.6732 ],
[ 3.0000 , 3.1311 , 4.5327 , 7.0312 , 11.2913 , 17.3609 ],
[ 3.0200 , 3.9276 , 5.6045 , 8.5938 , 13.5607 , 20.6323 ],
[ 3.0500 , 5.7957 , 8.0968 , 12.0625 , 18.4574 , 27.2841 ],
[ 3.0800 , 7.4414 , 10.2759 , 15.0 , 22.4738 , 32.5971 ],
[ 3.0900 , 7.4104 , 10.2331 , 14.9375 , 22.4397 , 32.5846 ],
[ 3.1000 , 6.9275 , 9.5933 , 14.1875 , 21.4827 , 31.3817 ],
[ 3.1200 , 5.3748 , 7.6468 , 11.5625 , 17.8766 , 26.7208 ],
[ 3.1500 , 3.418 , 4.9629 , 7.8125 , 12.6082 , 19.4889 ],
[ 3.2000 , 1.8801 , 2.8781 , 4.7188 , 7.9915 , 12.9087 ],
[ 3.3000 , 1.2322 , 1.8995 , 3.2188 , 5.6565 , 9.4327 ],
[ 3.4000 , 1.1104 , 1.732 , 2.9609 , 5.2506 , 8.8278 ],
[ 3.7000 , 1.2391 , 1.8927 , 3.1406 , 5.4441 , 9.0048 ],
[ 4.0000 , 0.8057 , 1.3283 , 2.3984 , 4.4443 , 7.271 ],
[ 5.0000 , 0.6957 , 1.1685 , 2.1719 , 4.1284 , 6.585 ],
[ 6.0000 , 0.7057 , 1.197 , 2.2031 , 4.1527 , 6.6795 ],
[ 7.0000 , 0.727 , 1.2241 , 2.2422 , 4.2084 , 6.7978 ],
[ 8.0000 , 0.7434 , 1.2429 , 2.2656 , 4.2344 , 6.8687 ],
[ 8.5000 , 0.7537 , 1.26 , 2.2969 , 4.2928 , 6.9634 ]
]

data_scenario_2 = [
[ 0.2113 , 0.9409 , 1.4857 , 2.5625 , 4.5441 , 7.6146 ],
[ 0.2400 , 1.1882 , 1.7949 , 2.9531 , 5.0484 , 8.2736 ],
[ 0.2600 , 1.3649 , 2.0331 , 3.2656 , 5.4785 , 8.7826 ],
[ 0.3000 , 1.5302 , 2.2556 , 3.5938 , 5.9717 , 9.4179 ],
[ 0.3300 , 1.5425 , 2.2856 , 3.6562 , 6.0755 , 9.5817 ],
[ 0.3600 , 1.5425 , 2.2856 , 3.6562 , 6.0755 , 9.6605 ],
[ 0.4000 , 1.4751 , 2.1926 , 3.5625 , 5.9481 , 9.4973 ],
[ 0.4300 , 1.4363 , 2.1349 , 3.4688 , 5.8193 , 9.3288 ],
[ 0.4600 , 1.3711 , 2.0678 , 3.375 , 5.7158 , 9.1972 ],
[ 0.5000 , 1.3521 , 2.0313 , 3.3281 , 5.6364 , 9.1045 ],
[ 0.5300 , 1.3328 , 2.0133 , 3.3125 , 5.61 , 9.0617 ],
[ 0.5600 , 1.3457 , 2.0218 , 3.3125 , 5.61 , 9.0617 ],
[ 0.6000 , 1.3328 , 2.0133 , 3.3125 , 5.61 , 9.0617 ],
[ 0.7000 , 1.3647 , 2.0504 , 3.3594 , 5.6893 , 9.1899 ],
[ 0.8000 , 1.4686 , 2.183 , 3.5469 , 5.9503 , 9.4634 ],
[ 0.8800 , 1.4612 , 2.1835 , 3.5625 , 5.9765 , 9.543 ],
[ 0.9000 , 1.4612 , 2.1835 , 3.5625 , 5.9765 , 9.581 ],
[ 0.9100 , 1.4816 , 2.2023 , 3.5781 , 6.0028 , 9.623 ],
[ 0.9200 , 1.4945 , 2.2215 , 3.6094 , 6.0552 , 9.6302 ],
[ 0.9300 , 1.501 , 2.2477 , 3.625 , 6.0814 , 9.6719 ],
[ 0.9400 , 1.5074 , 2.2574 , 3.6406 , 6.1076 , 9.7135 ],
[ 1.0000 , 1.6632 , 2.4518 , 3.9062 , 6.4287 , 10.1327 ],
[ 1.1000 , 1.6479 , 2.4242 , 3.9062 , 6.4287 , 10.2179 ],
[ 1.2000 , 1.7164 , 2.5302 , 4.0312 , 6.6344 , 10.413 ],
[ 1.3000 , 1.806 , 2.6488 , 4.2031 , 6.8502 , 10.7424 ],
[ 1.4000 , 1.9141 , 2.7792 , 4.375 , 7.0955 , 11.0241 ],
[ 1.5000 , 2.007 , 2.8999 , 4.5469 , 7.338 , 11.3932 ],
[ 1.6000 , 2.0691 , 3.0101 , 4.6875 , 7.5649 , 11.6411 ],
[ 1.7000 , 2.15 , 3.1125 , 4.8281 , 7.7149 , 11.9058 ],
[ 1.8000 , 2.1848 , 3.1628 , 4.9062 , 7.8397 , 12.0985 ],
[ 1.9000 , 2.2321 , 3.2156 , 4.9688 , 7.9396 , 12.1406 ],
[ 2.0000 , 2.2391 , 3.2257 , 4.9844 , 7.9646 , 12.1787 ],
[ 2.1000 , 2.2321 , 3.2156 , 4.9688 , 7.9396 , 12.1406 ],
[ 2.2000 , 2.204 , 3.1751 , 4.9062 , 7.8397 , 12.0985 ],
[ 2.3000 , 2.1431 , 3.1024 , 4.8125 , 7.7283 , 11.8826 ],
[ 2.4000 , 2.0944 , 3.0115 , 4.7031 , 7.5901 , 11.7323 ],
[ 2.5000 , 1.9893 , 2.9084 , 4.5469 , 7.338 , 11.4439 ],
[ 2.6000 , 1.9277 , 2.7991 , 4.4062 , 7.1462 , 11.1029 ],
[ 2.7000 , 1.8262 , 2.6783 , 4.25 , 6.9266 , 10.8153 ],
[ 2.8000 , 1.7859 , 2.6192 , 4.1562 , 6.807 , 10.6795 ],
[ 2.9000 , 1.8665 , 2.7374 , 4.3438 , 7.114 , 11.1613 ],
[ 3.0000 , 3.1294 , 4.4867 , 6.9062 , 10.953 , 16.5264 ],
[ 3.0200 , 3.8892 , 5.5237 , 8.4375 , 13.1124 , 19.5318 ],
[ 3.0500 , 5.6611 , 7.921 , 11.6875 , 17.604 , 25.5211 ],
[ 3.0800 , 7.1875 , 9.8828 , 14.375 , 21.1936 , 30.0779 ],
[ 3.0900 , 7.1562 , 9.8398 , 14.3125 , 21.1585 , 29.9817 ],
[ 3.1000 , 6.7061 , 9.3007 , 13.625 , 20.3051 , 28.9703 ],
[ 3.1200 , 5.2878 , 7.4541 , 11.1875 , 17.1185 , 24.9748 ],
[ 3.1500 , 3.3633 , 4.9173 , 7.6875 , 12.2226 , 18.5839 ],
[ 3.2000 , 1.8916 , 2.8419 , 4.6562 , 7.8115 , 12.4233 ],
[ 3.3000 , 1.2142 , 1.8872 , 3.1719 , 5.5235 , 9.0978 ],
[ 3.4000 , 1.1071 , 1.7168 , 2.9219 , 5.1348 , 8.5041 ],
[ 3.7000 , 1.2358 , 1.8771 , 3.1016 , 5.3022 , 8.6572 ],
[ 4.0000 , 0.7979 , 1.3154 , 2.375 , 4.363 , 7.1997 ],
[ 5.0000 , 0.6907 , 1.1658 , 2.1562 , 4.0299 , 6.5371 ],
[ 6.0000 , 0.7067 , 1.19 , 2.1797 , 4.0737 , 6.6082 ],
[ 7.0000 , 0.728 , 1.2172 , 2.2188 , 4.1114 , 6.7263 ],
[ 8.0000 , 0.7419 , 1.2316 , 2.2344 , 4.1581 , 6.7738 ],
[ 8.5000 , 0.7611 , 1.2548 , 2.2656 , 4.1982 , 6.8684 ]
]

fitparams_scenario_2 = [ 0.17999561,  0.36167031,  0.08634227,  1.2954662,   3.0827831 ,  0.04967494,
  6.80274716,  2.02962931,  0.99072903,  2.19155164]

data_scenario_1_reduced = [[i[0], i[3]] for i in data_scenario_1]
data_scenario_2_reduced = [[i[0], i[3]] for i in data_scenario_2]

def fCmsLimitVsM(m):
  return my_func(m, fitparams_scenario_1)

def fCmsLimitVsM_explicit(m):
  A = 3.082
  B = 1.18
  C = 552.0
  M = 0.315
  return A + B*exp( -552*(m - M)*(m - M) )

def myGaus(x, mu, sigma):
  return 1/( sigma * sqrt(2.0*pi) ) * exp( - (x - mu)*(x - mu) / 2.0/sigma/sigma )

def fCmsResolution ( m ):
  return (0.13 + m*0.065)/5.0

def fCmsLimitVsM_HybridNew(m): # return the limit for a given mass. If the mass point is not present, it makes an interpolation.
  if m >= 0.2113 and m <= 8.55:
    m_im1 = 0.2113
    m_i   = 0.2113
    for i in range(len(Limits_HybridNew)):
      m_i   = Limits_HybridNew[i][0]
      lim_i = Limits_HybridNew[i][1]
      if m == m_i:
        return lim_i
      elif m > m_im1 and m < m_i:
        a = (lim_i - lim_im1) / (m_i - m_im1)
        b = (lim_im1*m_i - lim_i*m_im1) / (m_i - m_im1)
        lim = a*m+b
        return lim
      m_im1 = m_i
      lim_im1 = lim_i
  else:
    print "Warning! Mass if outside the range."

# 2015 Granularity
#MGammaD_array = [0.2113,0.2200,0.2300,0.2400,0.2500,0.2600,0.2700,0.2800,0.2900,0.3000,0.3100,0.3200,0.3300,0.3400,0.3500,0.3600,0.3700,0.3800,0.3900,0.4000,0.4100,0.4200,0.4300,0.4400,0.4500,0.4600,0.4700,0.4800,0.4900,0.5000,0.6000,0.7000,0.8000,0.9000,1.0000,1.1000,1.2000,1.5000,2.0000,2.6000,2.7000,2.8000,2.9000,3.0000,3.1000,3.2000,3.3000,3.4000,3.7000,4.0000,5.0000,6.0000,7.0000,8.0000,8.5000]
# 2016 Granularity
MGammaD_array = [0.2113,0.2400,0.2600,0.3000,0.3300,0.3600,0.4000,0.4300,0.4600,0.5000,0.5300,0.5600,0.6000,0.7000,0.8000,0.8800,0.9000,0.9100,0.9200,0.9300,0.9400,1.0000,1.1000,1.2000,1.3000,1.4000,1.5000,1.6000,1.7000,1.8000,1.9000,2.0000,2.1000,2.2000,2.3000,2.4000,2.5000,2.6000,2.7000,2.8000,2.9000,3.0000,3.0200,3.0500,3.0800,3.0900,3.1000,3.1200,3.1500,3.2000,3.3000,3.4000,3.7000,4.0000,5.0000,6.0000,7.0000,8.0000,8.5000]

Limits_HybridNew = data_scenario_1_reduced
